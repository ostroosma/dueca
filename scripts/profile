# This script is included when DUECA is remotely started up via the
# rrundueca* scripts. Put platform specific environment variables etc. here

# Uncomment and adapt to override X guessing
# DISPLAY=:1

WESTONPID=$(pgrep --uid $(id --user) --newest weston)

if [ -n "$WESTONPID" ]; then
   XDGSET=$(tr '\0' '\n' </proc/$WESTONPID/environ | grep -E ^XDG_RUNTIME_DIR)
   DBUSSET=$(tr '\0' '\n' </proc/$WESTONPID/environ | grep -E ^DBUS_SESSION_BUS_ADDRESS)
   WDSET=$(tr '\0' '\n' </proc/$WESTONPID/environ | grep -E ^WESTON_DISPLAY)
   DSET=$(tr '\0' '\n' </proc/$WESTONPID/environ | grep -E ^DISPLAY)

   export $XDGSET
   export $DBUSSET
   export $WDSET
   export $DSET

   >&2 echo "Weston session detected"
   >&2 echo $XDGSET
   >&2 echo $WDSET
   >&2 echo $DSET

fi

XWAYLANDPID=$(pgrep --uid $(id --user) --newest Xwayland)

if [ -n "$XWAYLANDPID" -a -z "$DISPLAY" ]; then

   DSET=$(tr '\0' '\n' </proc/$XWAYLANDPID/environ | grep -E ^DISPLAY)
   export $DSET

   if [ -n "$DISPLAY" ]; then
      echo "Guessing DISPLAY as ${DISPLAY} from Xwayland"
   fi
fi

XORGPID=$(pgrep --uid $(id --user) --newest Xorg)
if [ -n "$XORGPID" -a -z "$DISPLAY" ]; then

   DISPLAY=$(ps -p $XORGPID -o args | tail -1 | awk '{print $NF}')

   if [ -n "$DISPLAY" ]; then
       echo "Guessing DISPLAY as ${DISPLAY} from Xorg/who"
   fi
fi

# simply guessing the default
if [ -z "$DISPLAY" ]; then
   DISPLAY=:0.0
   echo "Default guess for DISPLAY as ${DISPLAY}"
fi

export DISPLAY
export PATH=/usr/X11R6/bin:$PATH

#    NVIDIA valid 'FSAA' Values
#      value - description
#        0   -   Off
#        1   -   2x (2xMS)
#        5   -   4x (4xMS)
#        7   -   8x (4xMS, 4xCS)
#        8   -   16x (4xMS, 12xCS)
#        9   -   8x (4xSS, 2xMS)
#       10   -   8x (8xMS)
#       11   -   16x (4xSS, 4xMS)
#       12   -   16x (8xMS, 8xCS)
#       13   -   32x (4xSS, 8xMS)
#       14   -   32x (8xMS, 24xCS)
#       15   -   64x (16xSS, 4xMS)
#export __GL_FSAA_MODE=15

# NVIDIA anisotropic texture filtering options
#0      No anisotropic filtering
#1      2x anisotropic filtering
#2      4x anisotropic filtering
#3      8x anisotropic filtering
#4      16x anisotropic filtering
#export __GL_LOG_MAX_ANISO=4

# locale setting for DUECA v3 data logging
export LC_NUMERIC=en_US.UTF-8
